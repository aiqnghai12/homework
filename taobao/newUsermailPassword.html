<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/first.css">
    <style>
    .div0{height: 600px;}
    .email{font-size: 30px;width: 600px;text-align: center;color: #444;background: #ccc;height: 50px;line-height: 50px}
    </style>
     <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
    <!-- 邮箱密码注册 -->

    <div class="main1 div0">
        <p class="email"></p>
        <label for="">密&emsp;&emsp;码</label> <input type="text"  class="password passwordOne"> <span class="passwordOneSpan"></span> <br>
        <label for="">重复密码</label> <input type="password" class="password passwordTwo"> <span class="passwordTwoSpan"></span> <br>
        <button class="submit">提交</button><br>
    </div>


    <script>
        !function(){
            const email = document.querySelector(".email");
          const url = "http://10.31.162.16/taobao/";
          const password = document.querySelectorAll(".password");
          const submit = document.querySelector(".submit");
          const passwordTwoSpan = document.querySelector(".passwordTwoSpan");
          const passwordOneSpan = document.querySelector(".passwordOneSpan");
         init();
          function init(){
            let sp =   window.location.search.substring(1).split("=")[1];
            email.innerHTML = sp;
            password[0].oninput = e=>{
              if ((/^(?=\D+\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,16}$/).test(password[0].value)){
                passwordOneSpan.innerHTML = "大写字母开头带有8-16位数字 √";
                passwordOneSpan.style.color = "green";
                passwordOneSpan.bool = true;
              }else{
                passwordOneSpan.innerHTML = "大写字母开头带有8-16位数字 ×";
                passwordOneSpan.style.color = "red";
                passwordOneSpan.bool = false;
              }
            }

             password[1].oninput = e=>{
                 if(password[1].value==password[0].value){
                    passwordTwoSpan.innerHTML = "√";
                    passwordTwoSpan.bool = true;
                    passwordTwoSpan.style.color = "green";
                 }else{
                    passwordTwoSpan.innerHTML = "×";
                    passwordTwoSpan.bool = false;
                    passwordTwoSpan.style.color = "red";
                 }
             }

                    submit.onclick = e=>{
                        if(passwordOneSpan.bool && passwordTwoSpan.bool){
                           $.ajax({
                               type:"post",
                               url:url+"php/newPassword.php",
                               data:{
                                   email:sp,
                                   password:password[1].value
                               },success:function(data){
                                   if(data=="成功")
                                   window.location.href=url+"denglu.html";
                                  else{
                                      alert(data);
                                  }
                               }
                           })
                        }
                    }
          }
        }()
         

    </script>

</body>
</html>